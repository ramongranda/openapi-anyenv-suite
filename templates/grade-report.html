<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>OpenAPI Grade Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-slate-900 text-slate-100">
    <div class="max-w-6xl mx-auto p-6">
      <div class="flex items-center justify-between gap-4">
        <div>
          <h1 class="text-2xl font-semibold">OpenAPI Grade Report</h1>
          <p class="text-slate-400 text-sm">Generated by openapi-anyenv-suite</p>
        </div>
        <div class="flex items-center gap-3">
          <label for="compactToggle" class="text-sm text-slate-300">Compact (errors only)</label>
          <button id="compactToggle" class="relative inline-flex h-6 w-11 items-center rounded-full bg-slate-700 transition-colors">
            <span class="inline-block h-4 w-4 translate-x-1 rounded-full bg-white transition-transform"></span>
          </button>
        </div>
      </div>

      <div class="grid grid-cols-12 gap-4 mt-4">
        <div class="col-span-12 sm:col-span-4 bg-slate-800/80 border border-slate-700 rounded-lg p-4">
          <div class="space-y-2">
            <div>
              <div class="text-xs text-slate-400">Numeric Score</div>
              <div class="text-3xl font-bold">{{score}}</div>
            </div>
            <div>
              <div class="text-xs text-slate-400">Letter</div>
              <div><span class="inline-block px-3 py-1 rounded-full bg-sky-900/60 text-sky-300 font-semibold">{{letter}}</span></div>
            </div>
          </div>
        </div>

        <div class="col-span-12 sm:col-span-4 bg-slate-800/80 border border-slate-700 rounded-lg p-4">
          <div class="grid grid-cols-2 gap-4">
            <div>
              <div class="text-xs text-slate-400">Spectral Errors</div>
              <div class="inline-block px-2 py-1 rounded bg-rose-900/50 text-rose-300 font-semibold">{{spectralErrors}}</div>
            </div>
            <div>
              <div class="text-xs text-slate-400">Spectral Warnings</div>
              <div class="inline-block px-2 py-1 rounded bg-amber-900/50 text-amber-300 font-semibold">{{spectralWarnings}}</div>
            </div>
          </div>
        </div>

        <div class="col-span-12 sm:col-span-4 bg-slate-800/80 border border-slate-700 rounded-lg p-4">
          <div class="grid grid-cols-2 gap-4">
            <div>
              <div class="text-xs text-slate-400">Redocly Errors</div>
              <div class="inline-block px-2 py-1 rounded bg-rose-900/50 text-rose-300 font-semibold">{{redoclyErrors}}</div>
            </div>
            <div>
              <div class="text-xs text-slate-400">Redocly Warnings</div>
              <div class="inline-block px-2 py-1 rounded bg-amber-900/50 text-amber-300 font-semibold">{{redoclyWarnings}}</div>
            </div>
          </div>
        </div>
      </div>

      <section class="bg-slate-800/80 border border-slate-700 rounded-lg p-4 mt-4">
        <h2 class="text-sm text-slate-300 mb-2">Heuristics</h2>
        <div class="grid grid-cols-2 sm:grid-cols-5 gap-3 text-sm">
          <div><div class="text-slate-400 text-xs">Operations</div><div class="font-semibold">{{operations}}</div></div>
          <div><div class="text-slate-400 text-xs">Summaries</div><div class="font-semibold">{{summaryPct}}</div></div>
          <div><div class="text-slate-400 text-xs">Descriptions</div><div class="font-semibold">{{descPct}}</div></div>
          <div><div class="text-slate-400 text-xs">Has 4xx</div><div class="font-semibold">{{with4xxPct}}</div></div>
          <div><div class="text-slate-400 text-xs">OpId Unique</div><div class="font-semibold">{{opIdUniquePct}}</div></div>
          <div><div class="text-slate-400 text-xs">Title</div><div class="font-semibold">{{hasTitle}}</div></div>
          <div><div class="text-slate-400 text-xs">Version</div><div class="font-semibold">{{hasVersion}}</div></div>
          <div><div class="text-slate-400 text-xs">Servers</div><div class="font-semibold">{{hasServers}}</div></div>
          <div><div class="text-slate-400 text-xs">Security Schemes</div><div class="font-semibold">{{hasSecSchemes}}</div></div>
          <div><div class="text-slate-400 text-xs">Bonus</div><div class="font-semibold">{{bonus}}</div></div>
        </div>
      </section>

      {{SPECTRAL_SECTION}}
      {{REDOCLY_SECTION}}

      <p class="text-slate-400 text-xs mt-4">Sources: <code class="bg-slate-900 px-1 py-0.5 rounded">dist/grade-report.json</code></p>
    </div>
    <style>
      body.compact tr.sev-warn,
      body.compact tr.sev-warning,
      body.compact tr.sev-info { display: none; }
    </style>
    <script>
      (function(){
        const btn = document.getElementById('compactToggle');
        const apply = (on) => {
          document.body.classList.toggle('compact', !!on);
          btn.classList.toggle('bg-sky-600', !!on);
          const knob = btn.querySelector('span');
          if (knob) knob.style.transform = on ? 'translateX(1.25rem)' : 'translateX(0.25rem)';
          try { localStorage.setItem('gradeReportCompact', on ? '1' : '0'); } catch {}
        };
        let pref = null; try { pref = localStorage.getItem('gradeReportCompact'); } catch {}
        apply(pref === '1');
        btn.addEventListener('click', () => apply(!document.body.classList.contains('compact')));
      })();
    </script>
  </body>
  </html>
